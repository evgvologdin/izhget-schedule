{"version":3,"sources":["views/form/datetime/SelectTime.coffee"],"names":[],"mappings":"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","file":"../../../../views/form/datetime/SelectTime.js","sourcesContent":["define ['views/form/Modal', 'moment', 'moment_ru', 'inputmask'], (view, moment) ->\n  class view extends view\n    template: '\n      <div class=\"datetime\">\n        <div class=\"modal-wrap hide\">\n          <div class=\"modal\">\n            <div class=\"header\">\n              <input class=\"change\" type=\"datetime\">\n            </div>\n            <div class=\"section\">\n              <ul class=\"items\">\n                <li class=\"item\" data-format=\"DD\" data-type=\"day\" data-step=\"1\"></li>\n                <li class=\"item\" data-format=\"MMM\" data-type=\"month\" data-step=\"1\"></li>\n                <li class=\"item\" data-format=\"YYYY\" data-type=\"year\" data-step=\"1\"></li>\n                <li class=\"item\" data-format=\"HH\" data-type=\"hour\" data-step=\"1\"></li>\n                <li class=\"delimiter\">:</li>\n                <li class=\"item\" data-format=\"mm\" data-type=\"minutes\" data-step=\"10\"></li>\n              </ul>\n            </div>\n            <div class=\"footer\">\n              <button class=\"choose\" type=\"button\">Ок</button>\n              <button class=\"cancel danger\" type=\"button\">Отмена</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    '\n    \n    render: (format) ->\n      self      = this\n      wrap      = super()\n      select    = $('#select-time')\n      block     = wrap.find \".#{@wrapper}\"\n      modal     = wrap.find '.modal'\n      items     = wrap.find '.item'\n      change    = wrap.find '.change'\n      cancel    = wrap.find '.cancel'\n      choose    = wrap.find '.choose'\n      message   = wrap.find '.not-fount'\n      format    = format\n      maskinput = format.replace /\\w/g, 9\n      datetime  = moment()\n      \n      nextinput = () ->\n        select.parents('#select-time-block').nextAll().find('input:visible').first().focus()\n      previnput = () ->\n        select.parents('#select-time-block').prevAll().find('input:visible').last().focus()\n\n      # Show modal\n      select.on 'focus click', () ->\n        if moment(select.val(), format).format() isnt 'Invalid date'\n          datetime = moment(select.val(), format)\n\n        change.val datetime.format format\n        change.trigger 'setdata'\n        \n        self.show () -> setTimeout () -> change.focus()\n            \n      # Hide modal\n      cancel.on 'click keypress', (e) -> \n        nextinput() if e.type is 'keypress' and e.keyCode is 13\n        self.hide()\n            \n      # Chose time and hide modal\n      choose.on 'click keypress', (e) ->\n        if moment(change.val(), format).format() isnt 'Invalid date'\n          datetime = moment(change.val(), format)\n        select.val datetime.format format\n        \n        nextinput() if e.type is 'keypress' and e.keyCode is 13\n        self.hide()\n          \n      change.on 'input keydown setdata', (e) -> \n        if moment(@value, format).format() isnt 'Invalid date'\n          datetime = moment(@value, format)\n          \n        # keybord nav select\n        if e.type is 'keydown' and e.keyCode is 13\n          e.preventDefault()\n          nextinput()\n          choose.trigger 'click'\n          \n        # keybord nav shift+tab\n        if e.type is 'keydown' and e.shiftKey and e.keyCode is 9\n          previnput()\n          \n        items.each () ->\n          item = $(this)\n          \n          if item.find('.value').length > 0\n            item.find('.value').text datetime.format item.attr 'data-format'\n            \n          else\n            plus  = $('<button class=\"plus\"  type=\"button\">+</button>')\n            minus = $('<button class=\"minus\" type=\"button\">&minus;</button>')\n            value = $('<span class=\"value\" />').text datetime.format item.attr 'data-format'\n\n            plus.on 'click', () ->\n              rem = 0\n              if moment(change.val(), format).format(item.attr('data-format')).match /\\d+/\n                rem = moment(change.val(), format).format(item.attr('data-format')) % parseInt(item.attr('data-step'))\n              add = parseInt(item.attr('data-step')) - rem\n              datetime.add add, item.attr('data-type')\n              change.val datetime.format format\n              change.trigger 'setdata'\n\n            minus.on 'click', () ->\n              rem = 0\n              if moment(change.val(), format).format(item.attr('data-format')).match /\\d+/\n                rem = moment(change.val(), format).format(item.attr('data-format')) % parseInt(item.attr('data-step'))\n              add = if rem > 0 then rem else parseInt(item.attr('data-step'))\n              datetime.add 0 - add, item.attr('data-type')\n              change.val datetime.format format\n              change.trigger 'setdata'\n\n            item.append(plus).append(value).append(minus)\n      \n            \n      select.inputmask maskinput\n      change.inputmask maskinput\n      select.attr 'readonly': true\n      select.after wrap\n      select.prependTo wrap"]}