{"version":3,"sources":["views/form/Stations.coffee"],"names":[],"mappings":"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","file":"../../../views/form/Stations.js","sourcesContent":["define ['views/form/Modal'], (view) ->  \n  class view extends view\n    template: '\n      <div class=\"select\">\n        <input class=\"select\" readonly=\"readonly\" type=\"text\" />\n        <div class=\"<%=wrapper%> hide\">\n          <div class=\"modal\">\n            <div class=\"header\">\n              <input class=\"search\" type=\"text\" />\n            </div>\n            <div class=\"section\">\n              <ul class=\"items\"></ul>\n              <ul class=\"not-fount hide\">\n                <li class=\"text-center\">\n                  <em>Нет результатов</em>\n                </li>\n              </ul>\n            </div>\n            <div class=\"footer\">\n              <button class=\"cancel danger\" type=\"button\">Отмена</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    '\n      \n    render: (select, stations, autoselect = true) ->\n      self      = this\n      wrap      = super()\n      select    = select\n      block     = wrap.find \".#{@wrapper}\"\n      modal     = wrap.find '.modal'\n      items     = wrap.find '.items'\n      input     = wrap.find '.select'\n      search    = wrap.find '.search'\n      cancel    = wrap.find '.cancel'\n      message   = wrap.find '.not-fount'\n      \n      nextinput = () ->\n        select.parents('.form-group').nextAll().find('input:visible').first().focus()\n      previnput = () ->\n        select.parents('.form-group').prevAll().find('input:visible').last().focus()\n\n      # Render select option\n      for station in stations\n        option   = $ '<option />'\n        option.html station.getAttr 'name'\n        option.val  station.getAttr 'id'\n        option.attr 'selected': if parseInt(select.attr('data-value')) is station.getAttr('id') then true else false\n        select.append option\n\n        listitem = $ '<li />'\n        listitem.html station.getAttr 'name'\n        listitem.attr 'data-value': station.getAttr 'id'\n        listitem.on   'click', (e) ->\n          select.val $(this).attr 'data-value'\n          select.trigger 'change'\n          self.hide()\n        items.append listitem\n\n      # Change select    \n      select.on 'change', () ->\n        value = @value\n        $(this).find('option').each () ->\n          if @value is value\n            input.val @innerHTML\n      select.trigger 'change'\n\n      # Append to page    \n      select.addClass 'hide'\n      select.after wrap\n      select.prependTo wrap\n      select.trigger 'change'\n    \n      # Show modal\n      input.on 'focus click', () ->\n        self.show () ->\n          search.val ''\n          setTimeout () -> search.focus()\n    \n      # Hide modal\n      cancel.on 'keypress click', (e) -> \n        console.log nextinput\n        nextinput() if e.type is 'keypress' and e.keyCode is 13\n        self.hide()\n         \n      # Search items\n      search.on 'focus input keydown', (e) ->\n        # keybord nav down\n        if e.type is 'keydown' and e.keyCode is 40\n          if items.find('.focus').length is 0 \n            items.children().not('.hide').first().addClass 'focus'\n          else\n            items.find('.focus').removeClass('focus').nextAll().not('.hide').first().addClass 'focus'\n            \n        # keybord nav up\n        if e.type is 'keydown' and e.keyCode is 38\n          if items.find('.focus').length is 0 \n            items.children().not('.hide').last().addClass 'focus'\n          else\n            items.find('.focus').removeClass('focus').prevAll().not('.hide').first().addClass 'focus'\n\n        # keybord nav scroll\n        if e.type is 'keydown' and (e.keyCode is 40 or e.keyCode is 38)\n          focus  = items.find '.focus'\n          if focus.length isnt 0\n            parent = items.parent()\n            parent.scrollTop focus.outerHeight() * focus.index()\n\n        # keybord nav select\n        if e.type is 'keydown' and e.keyCode is 13\n          e.preventDefault()\n          focus = items.find '.focus'\n          if focus.length isnt 0\n            focus.trigger('click')\n            nextinput()\n            \n        # keybord nav shift+tab\n        if e.type is 'keydown' and e.shiftKey and e.keyCode is 9\n          previnput()\n      \n        # search\n        value = @value.toLowerCase()\n        items.find('li').each () ->\n          if @innerHTML.toLowerCase().search(value) is -1\n            $(this).addClass 'hide'\n            $(this).removeClass 'focus'\n            $(this).removeClass 'show'\n          else\n            $(this).addClass 'show'\n            $(this).removeClass 'hide'\n\n        if items.find('.show').length is 0\n          items.addClass 'hide'\n          message.removeClass 'hide'\n        else\n          items.removeClass 'hide'\n          message.addClass 'hide'\n          \n      # AutoSelect station by user coordinates \n      if 'geolocation' of navigator and autoselect isnt false and select.val().length is 0\n        navigator.geolocation.getCurrentPosition (position) ->\n          \n          distance = false\n          minindex = false\n\n          for station in stations\n            coords = station.getAttr 'coords'\n            if $.isArray(coords) is false or coords.length is 0\n              continue\n\n            for coord in coords\n              if distance is false and minindex is false\n                minindex  = station.getAttr 'id'\n                distance  = Math.pow coord[0] - position.coords.latitude,  2\n                distance += Math.pow coord[1] - position.coords.longitude, 2\n              else\n                check  = Math.pow coord[0] - position.coords.latitude,  2\n                check += Math.pow coord[1] - position.coords.longitude, 2\n\n                if check <= distance\n                  minindex  = station.getAttr 'id'\n                  distance = check\n\n          if minindex isnt false\n            select.val(minindex).trigger 'change'\n      \n      return @"]}